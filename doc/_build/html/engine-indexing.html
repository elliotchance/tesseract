

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Indexing &mdash; tesseract 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="tesseract 1.0.0 documentation" href="index.html"/>
        <link rel="up" title="Engine" href="engine.html"/>
        <link rel="next" title="Formatting" href="formatting.html"/>
        <link rel="prev" title="Engine" href="engine.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="index.html" class="icon icon-home"> tesseract
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sql-reference.html">SQL Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sql-create-index.html">CREATE INDEX</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sql-create-index.html#syntax">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="sql-create-index.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sql-create-index.html#id5">}</a></li>
<li class="toctree-l4"><a class="reference internal" href="sql-create-index.html#id10">]</a></li>
<li class="toctree-l4"><a class="reference internal" href="sql-create-index.html#id17">]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sql-create-notification.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-create-notification.html#notes">Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-delete.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-drop-index.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-drop-notification.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-drop-table.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-insert.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-insert.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-select.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-update.html">Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-reference.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-reference.html#running-the-server">Running the Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-reference.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="sql-reference.html#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="engine.html">Engine</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Indexing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="formatting.html">Formatting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="formatting.html#basic">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="formatting.html#sql-examples">SQL Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="formatting.html#syntax-descriptions">Syntax Descriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="formatting.html#notes">Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="formatting.html#tables">Tables</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">tesseract</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="engine.html">Engine</a> &raquo;</li>
      
    <li>Indexing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/engine-indexing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-tesseract.index">
<span id="indexing"></span><h1>Indexing<a class="headerlink" href="#module-tesseract.index" title="Permalink to this headline">Â¶</a></h1>
<p>An index is used to speed up lookup operations. You can expect that these
work exactly the same as any other RDBMS.</p>
<p>Lets run through an example with a table called &#8220;mytable&#8221;. The preceding number
is the record ID which the index references and is non-linear on purpose so that
we don&#8217;t get confused later:</p>
<div class="highlight-python"><div class="highlight"><pre>10. {&quot;x&quot;: 123}
11. {&quot;x&quot;: true}
15. {&quot;x&quot;: &quot;foo&quot;}
17. {}
20. {&quot;x&quot;: 123}
23. {&quot;x&quot;: 57}
</pre></div>
</div>
<p>The index is created like:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE INDEX myindex ON mytable (x)
</pre></div>
</div>
<p>Unlike most other database systems we need to index different data types in the
same index. To achieve this we need to separate numbers from non-numbers and
maintain a separate index for each respectively.</p>
<p>Lets look at the numbers first. The numbers index is sorted set that uses the
score as the value (could be an integer or float) and value as the record ID:</p>
<div class="highlight-python"><div class="highlight"><pre>57  -&gt; &quot;23&quot;
123 -&gt; &quot;10&quot;
123 -&gt; &quot;20&quot;
</pre></div>
</div>
<p>For the non-numbers index which could contain NULLs, booleans, strings or even
arrays and objects (more on arrays and objects later) we also use a sorted set
but the roles are reversed with the score containing the record ID and the value
is a string.</p>
<p>Now we run into the first minor problem. Redis requires all values in a sorted
set to be unique. This is not an issue for the numbers index since the record ID
is unique in all cases but is is a problem for the non-numbers index.</p>
<p>To get around this we add the record ID to the end of the string:</p>
<div class="highlight-python"><div class="highlight"><pre>11 -&gt; &quot;T:11&quot;
15 -&gt; &quot;Sfoo:15&quot;
17 -&gt; &quot;N:17&quot;
</pre></div>
</div>
<p>The first character is the type:</p>
<div class="highlight-python"><div class="highlight"><pre>N null
T true
F false
S string (followed by the actual string)
</pre></div>
</div>
<p>The indexes are named with as &#8220;index:mytable:myindex:number&#8221; and
&#8220;index:mytable:myindex:nonnumber&#8221;. The table name is kept in the key because an
index can only apply to a single table.</p>
<p>Now that we know how indexes are stored we can request back records. The first
and most important step is to determine if the value we are looking up is a
number or a non-number then use the appropriate index.</p>
<p>In the case of a number we can use the Redis ZRANGEBYSCORE command, and for
non-numbers we can use the ZRANGEBYLEX on the non-number index.</p>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="formatting.html" class="btn btn-neutral float-right" title="Formatting" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="engine.html" class="btn btn-neutral" title="Engine" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Elliot Chance.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>